{% extends 'base.html.twig' %}

{% block title %}User{% endblock %}

{% block body %}
    <div hidden>{{ user.id }}</div>
    <div class="container">
        <div class="row mb-5">
            <h3 class="text-center col-12 border-bottom border-primary">Bienvenue {{ user.firstname }}</h3>
        </div>

        <div class="row">
            {#  navigation dans les diefférents onglets accesibles par l'adherent#}
            <div class="col-12 col-lg-12">
                {#  navigation dans les différentes zones 3 en initiales#}
                <section id="tabs" class="project-tab">

                    <div class="col-lg-12">
                        <nav>
                            <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
                                <a class="nav-item nav-link active" id="nav-account-tab" data-toggle="tab"
                                   href="#nav-account" role="tab" aria-controls="nav-account"
                                   aria-selected="false">Mon compte</a>
                                <a class="nav-item nav-link " id="nav-inscription-tab" data-toggle="tab"
                                   href="#nav-inscription" role="tab" aria-controls="nav-inscription"
                                   aria-selected="true">Mon
                                    inscription au PMT</a>
                                <a class="nav-item nav-link" id="nav-sortie-tab" data-toggle="tab"
                                   href="#nav-sortie" role="tab" aria-controls="nav-sortie"
                                   aria-selected="false">Les sorties</a>
                                <a class="nav-item nav-link" id="nav-messorties-tab" data-toggle="tab"
                                   href="#nav-messorties" role="tab" aria-controls="nav-messorties"
                                   aria-selected="false">Mes sorties</a>
                                <a class="nav-item nav-link" id="nav-document-tab" data-toggle="tab"
                                   href="#nav-document" role="tab" aria-controls="nav-document"
                                   aria-selected="false">Mes documents</a>
                            </div>
                        </nav>

                        <div class="tab-content" id="nav-tabContent">
                            {#  affichage du compte de l'utlisteu#}
                            <div class="tab-pane fade show active" id="nav-account" role="tabpanel"
                                 aria-labelledby="nav-home-tab">
                                <div class="card mb-3" style="max-width: 100%;">
                                    <div class="row no-gutters">
                                        <div class="col-md-4">
                                            {% if user is null %}
                                                <img src="" class="card-img" alt="...">
                                            {% else %}
                                                <img src="{{ '/uploads/images/users/' ~ user.imageName }}"
                                                     class="card-img" alt="...">
                                            {% endif %}
                                        </div>
                                        <div class="col-md-8">
                                            <div class="card-body">
                                                <h5 class="card-title font-weight-bold">{{ user.firstname }} {{ user.lastname }}</h5>
                                                <p class="card-text">mail:{{ user.email }} </p>
                                                <p class="card-text">Téléphone:{{ user.homePhone }} </p>
                                                <p class="card-text">Mobile:{{ user.mobilePhone }} </p>
                                                <p class="card-text">Adresse:{{ user.address }} </p>
                                                <p class="card-text">{{ user.zipCode }} {{ user.city }} </p>
                                                <p class="card-text">Date
                                                    naissance: {{ user.birthday ? user.birthday|localizeddate('none', 'none', null, null, 'eeee d MMMM Y') : '' }} </p>
                                            </div>
                                        </div>
                                    </div>
                                    {#   gestion si membre inscrit ou pas. si  inscrit info inscription ,si pas inscript
                                    on renvoi la validation de l'inscription #}
                                    <div class="card-footer bg-transparent border-success">
                                        <a href="{{ path('user_edit', {'id': user.id}) }}"
                                           class="btn btn-primary text-white">Modifiez
                                            vos informations</a>

                                    </div>
                                </div>
                            </div>

                            {#  affichage du statut de l'inscription onglet mon inscription#}
                            <div class="tab-pane fade show" id="nav-inscription" role="tabpanel"
                                 aria-labelledby="nav-home-tab">

                                {#                                si pas inscrit on affiche le lien vers le form d'inscription: si inscrit info de l'inscription#}
                                {% if user.inscriptions is empty %}
                                    <div><a href="{{ path('inscriptionForm') }}">S'inscrire</a></div>

                                {% else %}


                                    {% for inscr in user.inscriptions %}

                                        <div class="mt-3">Ma periode d'inscription :
                                            <strong>{{ inscr.inscriptionYear }}</strong></div>
                                        <div class="mt-3">Statut de votre inscription:
                                            <strong>{{ inscr.inscriptionStatus is null ? '' : 'A effectuer'  ~ inscr.inscriptionStatus.name }}</strong>
                                        </div>
                                        <h4 class="mt-3"><strong>Rôle et activités:</strong></h4>
                                        <ul style="list-style: square;">
                                            {% if user.isMonitor %}
                                                <li>{{ user.level is null ? '' : 'Moniteur: niveau '  ~ user.level.name }}</li>
                                            {% endif %}
                                            {% if user.isDiver %}
                                                <li> {{ user.level is null ? '' : 'Adhérent plongeur: niveau ' ~ user.level.name }}</li>
                                            {% endif %}
                                            {% if user.isSwim %}
                                                <li>{{ 'Adhérent nageur' }}</li>
                                            {% endif %}
                                            {% if user.isAdmin %}
                                                <li>{{ 'Authorisation: administration du site' }}</li>
                                            {% endif %}
                                        </ul>
                                        <h4 class="mt-3"><strong>Droits à l'image</strong></h4>
                                        <div class="mt-2">
                                            {{ inscr.imageRight? 'Vous avez autorisé la diffusion d\'image' : 'Vous n\'avez autorisé pas la diffusion d\'image' }}</div>
                                        <h4 class="mt-3"><strong>un commentaire?</strong></h4>
                                        <div>{{ user.comment }}</div>
                                        {#    PAs d'afficahge du statut isHandi    #}
                                    {% endfor %}

                                    <a href="{{ path ('pdf') }}"
                                       class="btn btn-info mb-5 mt-5">{{ button_label|default('Générer un pdf') }}</a>
                                    {#                                    end if si insrit ou pas: #}
                                {% endif %}

                            </div>

                            {# affichage de la listes des sorties #}
                            <div class="tab-pane fade" id="nav-sortie" role="tabpanel"
                                 aria-labelledby="nav-contact-tab">
                                <h4 class="mt-3"><strong>Listes des sorties
                                        disponibles: {{ tripsNotBooked|length }}</strong></h4>
                                {#                                         ajout  des sorties une par une : suelement celle en cours#}
                                {% for trip in tripsNotBooked %}
                                    {#                                            on cree une card  par trip #}
                                    {#                                    if trip is already book on ne l'affcieh pas sur cette onglet#}

                                    <div class="card mb-3" style="max-width: 100%;">
                                        <div class="row no-gutters">
                                            <div class="col-md-4">
                                                {% if trip is null %}
                                                    <img src="" class="card-img" alt="...">
                                                {% else %}
                                                    <img src="{{ '/uploads/images/gallery/' ~ trip.imageName }}"
                                                         class="card-img" alt="...">
                                                {% endif %}
                                            </div>
                                            <div class="col-md-8">
                                                <div class="card-body">
                                                    <h5 class="card-title">Sortie: {{ trip.name }}</h5>
                                                    <h5> lieu: {{ trip.location }}</h5>
                                                    <p class="card-text">{{ trip.description }}</p>
                                                    <p class="card-text"><small
                                                                class="text-muted">du {{ trip.dateStart|date("d/m/Y") }}
                                                            au {{ trip.dateEnd|date("d/m/Y") }}</small></p>
                                                </div>
                                            </div>
                                        </div>
                                        {#   gestion si membre inscrit ou pas. si  inscrit info inscription ,si pas inscript
                                        on renvoi la validation de l'inscription #}
                                        <div class="card-footer bg-transparent border-success">

                                            {#  creation du collapse de l'insription form participant Form2 de la page #}
                                            <button class="btn btn-primary" type="button" data-toggle="collapse"
                                                    data-target="#{{ 'collapse' ~ trip.id }}" aria-expanded="false"
                                                    aria-controls="{{ 'collapse' ~ trip.id }}">
                                                Accèder à l'inscription
                                            </button>
                                            <div class="collapse" id="{{ 'collapse' ~ trip.id }}">
                                                <div class="card card-body">
                                                    {#                                                    afficahge form de participation #}
                                                    <div class="container">
                                                        {% set formTrip = formTripRegistration.createView %}
                                                        {{ form_start(formTrip) }}
                                                        {{ form_widget(formTrip.trip, {"value" : trip.id, "attr": {"id": "participant_trip_" ~ trip.id} }) }}
                                                        {#                                                        {{ form_widget(form2.token, { "attr": {"id": "participant_token_" ~ trip.id} }) }}#}
                                                        {{ form_label(formTrip.payment, 'Choix de mon moyen de paiement') }}
                                                        {{ form_widget(formTrip.payment, {'attr': {'id': 'payment_trip_' ~ trip.id} }) }}

                                                        {{ form_label(formTrip.nbCompanion, 'Je viens avé mes copains!') }}
                                                        {{ form_widget(formTrip.nbCompanion, {"attr": {"id": "nbCompanion_trip_" ~ trip.id} }) }}
                                                        <button type="submit" class="btn btn-primary mt-4">M'inscrire
                                                        </button>
                                                        {{ form_end(formTrip) }}
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}

                            </div>

                            {# affichage de la listes des sorties ou le user est inscrit #}
                            <div class="tab-pane fade" id="nav-messorties" role="tabpanel"
                                 aria-labelledby="nav-contact-tab">
                                <h4 class="mt-3"><strong>Mes inscriptions aux
                                        sorties: {{ tripsAlreadyBook|length }}</strong></h4>
                                {#                                         ajout  des sorties une par une : suelement celle en cours#}
                                {% for bookTrip in tripsAlreadyBook %}
                                    {#                                    #}{#                                            on cree une card  par trip #}
                                    <div class="card mb-3" style="max-width: 100%;">
                                        <div class="row no-gutters">
                                            <div class="col-md-4">
                                                {% if bookTrip.trip is null %}
                                                    <img src="" class="card-img" alt="...">
                                                {% else %}
                                                    <img src="{{ '/uploads/images/gallery' ~ bookTrip.trip.imageName }}"
                                                         class="card-img" alt="...">
                                                {% endif %}
                                            </div>
                                            <div class="col-md-8">
                                                <div class="card-body">
                                                    <h5 class="card-title">Sortie: {{ bookTrip.trip.name }}</h5>
                                                    <h5> lieu: {{ bookTrip.trip.location }}</h5>
                                                    <p class="card-text">{{ bookTrip.trip.description }}</p>
                                                    <p class="card-text"><small
                                                                class="text-muted">du {{ bookTrip.trip.dateStart|date("d/m/Y") }}
                                                            au {{ bookTrip.trip.dateEnd|date("d/m/Y") }}</small></p>
                                                </div>
                                            </div>
                                        </div>

                                        {#   gestion si membre inscrit ou pas. si  inscrit info inscription ,si pas inscript
                                        on renvoi la validation de l'inscription #}
                                        <div class="card-footer bg-transparent border-success">
                                            {#                                            creation d'un from de déinscription #}
                                            {% set formTripCancel = formTripCancellation.createView %}
                                            {{ form_start(formTripCancel) }}
                                            {{ form_widget(formTripCancel.trip, {"value" : bookTrip.trip.id, "attr": {"id": "participant_trip_" ~ bookTrip.trip.id} }) }}
                                            <button type="submit" class="btn btn-primary mt-4">Me déinscrire</button>
                                            {{ form_end(formTripCancel) }}

                                        </div>
                                    </div>
                                {% endfor %}

                            </div>

                            {#                                    affichage de la zone de telechargement des docs #}
                            {#                            TODO faire affichage des lien à télécharge: 2 colonnes doc à uploader et doc en download#}
                            <div class="tab-pane fade" id="nav-document" role="tabpanel"
                                 aria-labelledby="nav-profile-tab">
                                <div class="row">
                                    <div class="col-6">
                                        <h4 class="mt-3">Documents modèle</h4>
                                        <ul>
                                            {% for document in documents %}
                                                <li>
                                                    <a href="{{ "/uploads/files/" ~ document.name }}">{{ document.name }}</a>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    <div class="col-6">
                                        <h4 class="mt-3">Mes documents importés</h4>
                                        <ul>
                                            <li>
                                                <a href="{{ "/uploads/files/users/" ~ inscription.internalProcedure }}">{{ inscription.internalProcedure }}</a>
                                                <a href="{{ "/uploads/files/users/" ~ inscription.medicalCertificate }}">{{ inscription.medicalCertificate }}</a>
                                                <a href="{{ "/uploads/files/users/" ~ inscription.inscriptionSheet }}">{{ inscription.inscriptionSheet }}</a>
                                                <a href="{{ "/uploads/files/users/" ~ inscription.imageRight }}">{{ inscription.imageRight }}</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                {#                                TODO ajouter liste des docs à télécharger en plus de ceux du menbres #}
                                <h4 class="mt-3">Importer mes documents</h4>
                                {% if user.inscriptions is empty %}
                                    <div class="mt-2">Aucun document disponible ( à revoir si besoin)</div>
                                {% else %}
                                    {% set formDoc = formDocuments.createView %}
                                    {{ form_start(formDoc) }}
                                    {{ form_row(formDoc.internalProcedure) }}
                                    {{ form_row(formDoc.medicalCertificate) }}
                                    {{ form_row(formDoc.inscriptionSheet) }}
                                    {{ form_row(formDoc.imageRight) }}
                                    <div class="row text-center">
                                        <button class="btn btn-primary col-12 col-sm-4 offset-4 mt-5 mb-5">{{ button_label|default('Save') }}</button>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                </section>

            </div>
        </div>
    </div>


{% endblock %}

{% block footer %}
    {% include '_footer.html.twig' %}
{% endblock %}
